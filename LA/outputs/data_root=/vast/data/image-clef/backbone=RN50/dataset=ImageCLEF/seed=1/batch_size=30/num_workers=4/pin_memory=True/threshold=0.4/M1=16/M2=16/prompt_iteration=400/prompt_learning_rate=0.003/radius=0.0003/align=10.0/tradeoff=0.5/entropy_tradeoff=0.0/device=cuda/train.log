===============================================================================================
Layer (type:depth-idx)                                                 Param #
===============================================================================================
Custom_Clip                                                            1
├─ModifiedResNet: 1-1                                                  --
│    └─Conv2d: 2-1                                                     (864)
│    └─BatchNorm2d: 2-2                                                (64)
│    └─ReLU: 2-3                                                       --
│    └─Conv2d: 2-4                                                     (9,216)
│    └─BatchNorm2d: 2-5                                                (64)
│    └─ReLU: 2-6                                                       --
│    └─Conv2d: 2-7                                                     (18,432)
│    └─BatchNorm2d: 2-8                                                (128)
│    └─ReLU: 2-9                                                       --
│    └─AvgPool2d: 2-10                                                 --
│    └─Sequential: 2-11                                                --
│    │    └─Bottleneck: 3-1                                            (75,008)
│    │    └─Bottleneck: 3-2                                            (70,400)
│    │    └─Bottleneck: 3-3                                            (70,400)
│    └─Sequential: 2-12                                                --
│    │    └─Bottleneck: 3-4                                            (379,392)
│    │    └─Bottleneck: 3-5                                            (280,064)
│    │    └─Bottleneck: 3-6                                            (280,064)
│    │    └─Bottleneck: 3-7                                            (280,064)
│    └─Sequential: 2-13                                                --
│    │    └─Bottleneck: 3-8                                            (1,512,448)
│    │    └─Bottleneck: 3-9                                            (1,117,184)
│    │    └─Bottleneck: 3-10                                           (1,117,184)
│    │    └─Bottleneck: 3-11                                           (1,117,184)
│    │    └─Bottleneck: 3-12                                           (1,117,184)
│    │    └─Bottleneck: 3-13                                           (1,117,184)
│    └─Sequential: 2-14                                                --
│    │    └─Bottleneck: 3-14                                           (6,039,552)
│    │    └─Bottleneck: 3-15                                           (4,462,592)
│    │    └─Bottleneck: 3-16                                           (4,462,592)
│    └─AttentionPool2d: 2-15                                           102,400
│    │    └─Linear: 3-17                                               (4,196,352)
│    │    └─Linear: 3-18                                               (4,196,352)
│    │    └─Linear: 3-19                                               (4,196,352)
│    │    └─Linear: 3-20                                               (2,098,176)
├─TextEncoder: 1-2                                                     563,712
│    └─Transformer: 2-16                                               --
│    │    └─Sequential: 3-21                                           (37,828,608)
│    └─LayerNorm: 2-17                                                 (1,024)
===============================================================================================
Total params: 76,710,241
Trainable params: 0
Non-trainable params: 76,710,241
===============================================================================================
Custom_Clip ===============================================================================================
Layer (type:depth-idx)                                                 Param #
===============================================================================================
Custom_Clip                                                            1
├─ModifiedResNet: 1-1                                                  --
│    └─Conv2d: 2-1                                                     (864)
│    └─BatchNorm2d: 2-2                                                (64)
│    └─ReLU: 2-3                                                       --
│    └─Conv2d: 2-4                                                     (9,216)
│    └─BatchNorm2d: 2-5                                                (64)
│    └─ReLU: 2-6                                                       --
│    └─Conv2d: 2-7                                                     (18,432)
│    └─BatchNorm2d: 2-8                                                (128)
│    └─ReLU: 2-9                                                       --
│    └─AvgPool2d: 2-10                                                 --
│    └─Sequential: 2-11                                                --
│    │    └─Bottleneck: 3-1                                            (75,008)
│    │    └─Bottleneck: 3-2                                            (70,400)
│    │    └─Bottleneck: 3-3                                            (70,400)
│    └─Sequential: 2-12                                                --
│    │    └─Bottleneck: 3-4                                            (379,392)
│    │    └─Bottleneck: 3-5                                            (280,064)
│    │    └─Bottleneck: 3-6                                            (280,064)
│    │    └─Bottleneck: 3-7                                            (280,064)
│    └─Sequential: 2-13                                                --
│    │    └─Bottleneck: 3-8                                            (1,512,448)
│    │    └─Bottleneck: 3-9                                            (1,117,184)
│    │    └─Bottleneck: 3-10                                           (1,117,184)
│    │    └─Bottleneck: 3-11                                           (1,117,184)
│    │    └─Bottleneck: 3-12                                           (1,117,184)
│    │    └─Bottleneck: 3-13                                           (1,117,184)
│    └─Sequential: 2-14                                                --
│    │    └─Bottleneck: 3-14                                           (6,039,552)
│    │    └─Bottleneck: 3-15                                           (4,462,592)
│    │    └─Bottleneck: 3-16                                           (4,462,592)
│    └─AttentionPool2d: 2-15                                           102,400
│    │    └─Linear: 3-17                                               (4,196,352)
│    │    └─Linear: 3-18                                               (4,196,352)
│    │    └─Linear: 3-19                                               (4,196,352)
│    │    └─Linear: 3-20                                               (2,098,176)
├─TextEncoder: 1-2                                                     563,712
│    └─Transformer: 2-16                                               --
│    │    └─Sequential: 3-21                                           (37,828,608)
│    └─LayerNorm: 2-17                                                 (1,024)
===============================================================================================
Total params: 76,710,241
Trainable params: 0
Non-trainable params: 76,710,241
===============================================================================================
**************************************************
Start training on b
Generating pseudo labels for b data
pseudo label correct rate is 0.685
Data statistic {'c': 600, 'i': 600, 'p': 591}
=================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
PromptGenerator =================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
name: ctx_cls, shape torch.Size([12, 16, 512]), require grad: True
name: ctx_source, shape torch.Size([1, 16, 512]), require grad: True
name: ctx_target, shape torch.Size([1, 16, 512]), require grad: True
Best accuracy so far: 0.285, step 1
Best accuracy so far: 0.3333333333333333, step 1
Best accuracy so far: 0.34, step 2
Best accuracy so far: 0.43833333333333335, step 2
Best accuracy so far: 0.515, step 3
Best accuracy so far: 0.5516666666666666, step 4
Best accuracy so far: 0.6483333333333333, step 4
Best accuracy so far: 0.66, step 9
Best accuracy so far: 0.675, step 18
Best accuracy so far: 0.6766666666666666, step 19
Best accuracy so far: 0.6983333333333334, step 20
Best accuracy so far: 0.7133333333333334, step 22
Best accuracy so far: 0.7333333333333333, step 26
Best accuracy so far: 0.7483333333333333, step 26
**************************************************
Start training on c
Generating pseudo labels for c data
pseudo label correct rate is 0.8783333333333333
Data statistic {'b': 600, 'i': 600, 'p': 591}
=================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
PromptGenerator =================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
name: ctx_cls, shape torch.Size([12, 16, 512]), require grad: True
name: ctx_source, shape torch.Size([1, 16, 512]), require grad: True
name: ctx_target, shape torch.Size([1, 16, 512]), require grad: True
Best accuracy so far: 0.4083333333333333, step 1
Best accuracy so far: 0.4633333333333333, step 1
Best accuracy so far: 0.5766666666666667, step 2
Best accuracy so far: 0.7233333333333334, step 2
Best accuracy so far: 0.7333333333333333, step 3
Best accuracy so far: 0.76, step 3
Best accuracy so far: 0.8416666666666667, step 4
Best accuracy so far: 0.8633333333333333, step 4
Best accuracy so far: 0.885, step 5
Best accuracy so far: 0.905, step 5
Best accuracy so far: 0.92, step 7
Best accuracy so far: 0.9433333333333334, step 28
Best accuracy so far: 0.9666666666666667, step 28
Best accuracy so far: 0.9683333333333334, step 261
**************************************************
Start training on i
Generating pseudo labels for i data
pseudo label correct rate is 0.8816666666666667
Data statistic {'b': 600, 'c': 600, 'p': 591}
=================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
PromptGenerator =================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
name: ctx_cls, shape torch.Size([12, 16, 512]), require grad: True
name: ctx_source, shape torch.Size([1, 16, 512]), require grad: True
name: ctx_target, shape torch.Size([1, 16, 512]), require grad: True
Best accuracy so far: 0.5983333333333334, step 1
Best accuracy so far: 0.8033333333333333, step 2
Best accuracy so far: 0.8433333333333334, step 2
Best accuracy so far: 0.855, step 3
Best accuracy so far: 0.8983333333333333, step 5
Best accuracy so far: 0.9083333333333333, step 5
Best accuracy so far: 0.9333333333333333, step 11
Best accuracy so far: 0.94, step 55
Best accuracy so far: 0.9433333333333334, step 66
Best accuracy so far: 0.9533333333333334, step 77
Best accuracy so far: 0.9566666666666667, step 98
**************************************************
Start training on p
Generating pseudo labels for p data
pseudo label correct rate is 0.7868020304568528
Data statistic {'b': 600, 'c': 600, 'i': 600}
=================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
PromptGenerator =================================================================
Layer (type:depth-idx)                   Param #
=================================================================
PromptGenerator                          114,688
=================================================================
Total params: 114,688
Trainable params: 114,688
Non-trainable params: 0
=================================================================
name: ctx_cls, shape torch.Size([12, 16, 512]), require grad: True
name: ctx_source, shape torch.Size([1, 16, 512]), require grad: True
name: ctx_target, shape torch.Size([1, 16, 512]), require grad: True
Best accuracy so far: 0.4087719298245614, step 1
Best accuracy so far: 0.5929824561403508, step 2
Best accuracy so far: 0.6368421052631579, step 2
Best accuracy so far: 0.6666666666666666, step 3
Best accuracy so far: 0.6771929824561403, step 3
Best accuracy so far: 0.7263157894736842, step 4
Best accuracy so far: 0.7368421052631579, step 5
Best accuracy so far: 0.7789473684210526, step 6
Best accuracy so far: 0.7842105263157895, step 13
Best accuracy so far: 0.8087719298245614, step 23
Best accuracy so far: 0.8140350877192982, step 61
Best accuracy so far: 0.8456140350877193, step 62
Best accuracy for each domain: [0.7483333333333333, 0.9683333333333334, 0.9566666666666667, 0.8456140350877193] Average: 0.8797368421052632
